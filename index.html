<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilt Card Strategy Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            letter-spacing: 2px;
        }

        header h1 span {
            color: #ffd700;
        }

        .lang-toggle {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            padding: 8px 16px;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.4);
            border-radius: 20px;
            color: #ffd700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lang-toggle:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        header {
            position: relative;
        }

        .container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
        }

        .calc-section {
            flex: 2;
            transition: flex 0.3s ease;
        }

        .chat-section {
            flex: 1;
            min-width: 320px;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .chat-section.collapsed {
            flex: 0;
            min-width: 48px;
            max-width: 48px;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            .chat-section {
                max-width: 100%;
                min-width: 100%;
                height: 400px;
            }
            .chat-section.collapsed {
                height: 48px;
                min-width: 100%;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            height: 100%;
        }

        .panel-header {
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Calculator Panel */
        .calc-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .input-group input[type="number"] {
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1.1rem;
        }

        .input-group input[type="number"]:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-group h3 {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 4px;
        }

        .radio-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .radio-option {
            flex: 1;
            min-width: 100px;
        }

        .radio-option input {
            display: none;
        }

        .radio-option label {
            display: block;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .radio-option input:checked + label {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.15);
        }

        .radio-option label:hover {
            border-color: rgba(255, 215, 0, 0.5);
        }

        .card-info {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        /* Results */
        .results {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .results h3 {
            font-size: 1rem;
            margin-bottom: 16px;
            color: #ffd700;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .result-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 16px;
            border-radius: 10px;
        }

        .result-item .label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 4px;
        }

        .result-item .value {
            font-size: 1.4rem;
            font-weight: 600;
            color: #ffd700;
        }

        .result-item.full-width {
            grid-column: span 2;
        }

        .result-breakdown {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 0.9rem;
        }

        .breakdown-item .label {
            color: rgba(255, 255, 255, 0.7);
        }

        .breakdown-item .value {
            font-weight: 500;
        }

        /* Card comparison */
        .comparison {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
        }

        .comparison h3 {
            font-size: 1rem;
            margin-bottom: 16px;
            color: rgba(255, 255, 255, 0.9);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .comparison-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .comparison-card.best {
            border-color: #ffd700;
        }

        .comparison-card .card-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .comparison-card .card-value {
            font-size: 1.2rem;
            color: #ffd700;
            margin-bottom: 4px;
        }

        .comparison-card .card-detail {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .best-badge {
            background: #ffd700;
            color: #1a1a2e;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            margin-top: 8px;
            display: inline-block;
        }

        /* Chat Panel */
        .chat-panel {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 140px);
            max-height: 800px;
        }

        .chat-header {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(255, 215, 0, 0.2);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .toggle-btn:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        .toggle-btn svg {
            width: 18px;
            height: 18px;
            fill: #ffd700;
            transition: transform 0.3s;
        }

        .chat-section.collapsed .toggle-btn svg {
            transform: rotate(180deg);
        }

        .chat-content {
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .chat-section.collapsed .chat-content,
        .chat-section.collapsed .chat-header-title span {
            display: none;
        }

        .chat-section.collapsed .chat-panel {
            height: 100%;
        }

        .chat-section.collapsed .chat-header {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: 16px 8px;
            height: 100%;
            justify-content: flex-start;
            gap: 16px;
        }

        .chat-section.collapsed .toggle-btn {
            writing-mode: horizontal-tb;
        }

        .api-key-section {
            padding: 10px 12px;
            background: rgba(255, 215, 0, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .api-key-section input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 0.85rem;
        }

        .api-key-section input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            padding: 10px 14px;
            border-radius: 12px;
            max-width: 90%;
            line-height: 1.5;
            font-size: 0.85rem;
        }

        .message.user {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #1a1a2e;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message.assistant {
            background: rgba(255, 255, 255, 0.1);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message.assistant strong {
            color: #ffd700;
            font-weight: 600;
        }

        .message.assistant code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.8rem;
        }

        .message.assistant ul, .message.assistant ol {
            margin: 8px 0;
            padding-left: 20px;
        }

        .message.assistant li {
            margin: 4px 0;
        }

        .message.assistant p {
            margin: 6px 0;
        }

        .message.assistant p:first-child {
            margin-top: 0;
        }

        .message.assistant p:last-child {
            margin-bottom: 0;
        }

        .message.system {
            background: rgba(255, 100, 100, 0.2);
            align-self: center;
            font-size: 0.8rem;
            text-align: center;
        }

        .chat-input-container {
            padding: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 8px;
        }

        .chat-input-container input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 0.85rem;
        }

        .chat-input-container button {
            padding: 10px 16px;
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            font-size: 0.85rem;
        }

        .chat-input-container button:hover {
            transform: translateY(-1px);
        }

        .chat-input-container button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Typing indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 10px 14px;
            align-self: flex-start;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Welcome message */
        .welcome-message {
            text-align: center;
            padding: 16px 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .welcome-message h2 {
            color: #ffd700;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .welcome-message p {
            font-size: 0.8rem;
            line-height: 1.5;
        }

        .quick-questions {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .quick-question {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 8px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.75rem;
            text-align: left;
            color: #fff;
        }

        .quick-question:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.3);
        }

        /* 2D Input Selector */
        .input-2d-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 8px;
        }

        .input-2d-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .input-2d-header h3 {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .input-2d-values {
            display: flex;
            gap: 16px;
            font-size: 0.85rem;
        }

        .input-2d-values span {
            color: #ffd700;
            font-weight: 600;
        }

        .input-2d-wrapper {
            position: relative;
            display: flex;
            gap: 8px;
        }

        .input-2d-y-label {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 0;
        }

        .input-2d-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-2d-area {
            position: relative;
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(255, 215, 0, 0.15) 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            cursor: crosshair;
            touch-action: none;
            overflow: hidden;
        }

        .input-2d-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 20% 25%;
        }

        .input-2d-point {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            border: 3px solid #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 215, 0, 0.4);
            cursor: grab;
            z-index: 10;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .input-2d-point:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4), 0 0 30px rgba(255, 215, 0, 0.6);
        }

        .input-2d-crosshair-h,
        .input-2d-crosshair-v {
            position: absolute;
            background: rgba(255, 215, 0, 0.3);
            pointer-events: none;
        }

        .input-2d-crosshair-h {
            left: 0;
            right: 0;
            height: 1px;
        }

        .input-2d-crosshair-v {
            top: 0;
            bottom: 0;
            width: 1px;
        }

        .input-2d-x-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
        }

        .input-2d-scale {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            padding: 0 2px;
        }

        .input-2d-y-scale {
            position: absolute;
            left: -44px;
            top: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.4);
            text-align: right;
            width: 40px;
        }

        .input-2d-area-wrapper {
            position: relative;
            margin-left: 48px;
        }

        /* 2D + Manual Input Layout */
        .input-2d-row {
            display: flex;
            gap: 20px;
            align-items: stretch;
        }

        .input-2d-left {
            flex: 1;
            min-width: 0;
        }

        .input-2d-right {
            width: 140px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: center;
        }

        .manual-input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .manual-input-group label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .manual-input-group input {
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #ffd700;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
        }

        .manual-input-group input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }

        @media (max-width: 600px) {
            .input-2d-row {
                flex-direction: column;
            }
            .input-2d-right {
                width: 100%;
                flex-direction: row;
            }
            .manual-input-group {
                flex: 1;
            }
        }

        /* Tooltip styles */
        .label-with-help {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .help-btn {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.3);
            border: none;
            cursor: pointer;
            font-size: 10px;
            font-weight: 600;
            color: #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
        }

        .help-btn:hover {
            background: rgba(255, 215, 0, 0.5);
        }

        .tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: #fff;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            line-height: 1.5;
            width: 240px;
            text-align: left;
            font-weight: 400;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.95);
        }

        .help-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .tooltip strong {
            color: #ffd700;
        }

        .breakdown-item .help-btn {
            width: 14px;
            height: 14px;
            font-size: 9px;
        }

        .breakdown-item .tooltip {
            width: 220px;
        }
    </style>
</head>
<body>
    <header>
        <h1>BILT <span>2.0</span> <span data-i18n="site_title">Card Strategy</span></h1>
        <button class="lang-toggle" onclick="toggleLanguage()" id="langToggle">한국어</button>
    </header>

    <div class="container">
        <!-- Calculator Section -->
        <div class="calc-section">
            <div class="panel">
                <div class="panel-header" data-i18n="calculator">Calculator</div>
                <div class="calc-content">
                    <!-- 2D Input Selector -->
                    <div class="input-2d-container">
                        <div class="input-2d-header">
                            <h3 data-i18n="spend_settings">Spend Settings</h3>
                        </div>
                        <div class="input-2d-row">
                            <div class="input-2d-left">
                                <div class="input-2d-wrapper">
                                    <div class="input-2d-y-label"><span data-i18n="housing_short">Housing</span> →</div>
                                    <div class="input-2d-main">
                                        <div class="input-2d-area-wrapper">
                                            <div class="input-2d-y-scale">
                                                <span>$5k</span>
                                                <span>$2.5k</span>
                                                <span>$0</span>
                                            </div>
                                            <div class="input-2d-area" id="input2dArea">
                                                <div class="input-2d-crosshair-h" id="crosshairH"></div>
                                                <div class="input-2d-crosshair-v" id="crosshairV"></div>
                                                <div class="input-2d-point" id="input2dPoint"></div>
                                            </div>
                                        </div>
                                        <div class="input-2d-x-label">→ <span data-i18n="everyday_spend_short">Everyday Spend</span></div>
                                        <div class="input-2d-scale">
                                            <span>$0</span>
                                            <span>$2.5k</span>
                                            <span>$5k</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="input-2d-right">
                                <div class="manual-input-group">
                                    <label data-i18n="monthly_housing">Monthly Housing</label>
                                    <input type="number" id="housingCost" value="2000" min="0" max="10000" step="50" oninput="onManualInput()">
                                </div>
                                <div class="manual-input-group">
                                    <label data-i18n="monthly_everyday">Monthly Everyday Spend</label>
                                    <input type="number" id="everydaySpend" value="1500" min="0" max="10000" step="50" oninput="onManualInput()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="radio-group">
                        <h3 data-i18n="card_selection">Card Selection</h3>
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" name="card" id="cardBlue" value="blue" onchange="calculate()">
                                <label for="cardBlue">
                                    Blue
                                    <div class="card-info"><span data-i18n="annual_fee">Annual Fee</span> $0</div>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="card" id="cardObsidian" value="obsidian" onchange="calculate()">
                                <label for="cardObsidian">
                                    Obsidian
                                    <div class="card-info"><span data-i18n="annual_fee">Annual Fee</span> $95</div>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="card" id="cardPalladium" value="palladium" checked onchange="calculate()">
                                <label for="cardPalladium">
                                    Palladium
                                    <div class="card-info"><span data-i18n="annual_fee">Annual Fee</span> $495</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="radio-group">
                        <h3 data-i18n="reward_option">Reward Option</h3>
                        <div class="radio-options">
                            <div class="radio-option">
                                <input type="radio" name="option" id="optionHousing" value="housing" onchange="calculate()">
                                <label for="optionHousing">
                                    <span data-i18n="housing_only">Housing-only</span>
                                    <div class="card-info" data-i18n="housing_only_desc">Auto 0X~1.25X</div>
                                </label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="option" id="optionFlexible" value="flexible" checked onchange="calculate()">
                                <label for="optionFlexible">
                                    <span data-i18n="flexible_cash">Flexible Cash</span>
                                    <div class="card-info" data-i18n="flexible_cash_desc">4% Cash + Max 1X</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="results">
                        <h3>계산 결과</h3>
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="label label-with-help">
                                    월간 주거비 포인트
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            <strong>Housing-only:</strong> 주거비 × 배율 (0~1.25X)<br>
                                            배율은 Everyday Spend Ratio로 결정됨<br><br>
                                            <strong>Flexible:</strong> Bilt Cash로 잠금 해제<br>
                                            $3 Cash = 100 포인트 (최대 1X)
                                        </div>
                                    </button>
                                </div>
                                <div class="value" id="monthlyHousingPoints">-</div>
                            </div>
                            <div class="result-item">
                                <div class="label label-with-help">
                                    월간 일상 지출 포인트
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            <strong>Blue:</strong> 일상 지출 × 1X<br>
                                            <strong>Obsidian:</strong> 평균 1.5X (여행 2X, 다이닝/그로서리 3X)<br>
                                            <strong>Palladium:</strong> 일상 지출 × 2X
                                        </div>
                                    </button>
                                </div>
                                <div class="value" id="monthlyEverydayPoints">-</div>
                            </div>
                            <div class="result-item">
                                <div class="label label-with-help">
                                    월간 Bilt Cash
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            <strong>Flexible 옵션만 해당</strong><br>
                                            일상 지출 × 4% = Bilt Cash<br><br>
                                            Housing-only 옵션에서는 Bilt Cash 적립 없음
                                        </div>
                                    </button>
                                </div>
                                <div class="value" id="monthlyBiltCash">-</div>
                            </div>
                            <div class="result-item">
                                <div class="label label-with-help">
                                    남은 Bilt Cash
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            주거비 포인트 잠금 해제 후 남은 Bilt Cash<br><br>
                                            <strong>계산:</strong> 월간 Cash - (잠금 해제 포인트 ÷ 100 × $3)<br><br>
                                            남은 Cash는 다른 용도로 사용 가능
                                        </div>
                                    </button>
                                </div>
                                <div class="value" id="remainingBiltCash">-</div>
                            </div>
                            <div class="result-item full-width">
                                <div class="label label-with-help">
                                    연간 총 가치 (예상)
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            <strong>계산 공식:</strong><br>
                                            (연간 포인트 × $0.015) + 연간 남은 Cash + 연간 혜택 - 연회비<br><br>
                                            <strong>포인트 가치:</strong> 1포인트 = 1.5센트 (보수적)<br>
                                            <strong>연간 혜택:</strong> Obsidian $100, Palladium $600
                                        </div>
                                    </button>
                                </div>
                                <div class="value" id="annualValue">-</div>
                            </div>
                        </div>
                        <div class="result-breakdown">
                            <div class="breakdown-item">
                                <span class="label label-with-help">
                                    Everyday Spend Ratio
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            일상 지출 ÷ 주거비 × 100%<br><br>
                                            Housing-only 옵션에서 주거비 포인트 배율을 결정하는 기준
                                        </div>
                                    </button>
                                </span>
                                <span class="value" id="spendRatio">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="label label-with-help">
                                    Housing-only 배율
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            <strong>Ratio별 배율:</strong><br>
                                            25% 미만: 0X (최소 250pt)<br>
                                            25~50%: 0.5X<br>
                                            50~75%: 0.75X<br>
                                            75~100%: 1X<br>
                                            100%+: 1.25X
                                        </div>
                                    </button>
                                </span>
                                <span class="value" id="housingMultiplier">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="label label-with-help">
                                    연간 포인트 총계
                                    <button class="help-btn">?
                                        <div class="tooltip">
                                            (월간 주거비 포인트 + 월간 일상 지출 포인트) × 12개월
                                        </div>
                                    </button>
                                </span>
                                <span class="value" id="annualPoints">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="comparison">
                        <h3>카드별 연간 가치 비교</h3>
                        <div class="comparison-grid" id="comparisonGrid">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="chat-section" id="chatSection">
            <div class="panel chat-panel">
                <div class="chat-header">
                    <div class="chat-header-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#ffd700">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12z"/>
                        </svg>
                        <span>AI Assistant</span>
                    </div>
                    <button class="toggle-btn" onclick="toggleChat()" title="접기/펼치기">
                        <svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                        </svg>
                    </button>
                </div>
                <div class="chat-content">
                    <div class="api-key-section">
                        <input type="password" id="apiKey" placeholder="Gemini API Key 입력">
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="welcome-message">
                            <h2>Bilt 카드 도우미</h2>
                            <p>카드 선택, 리워드 옵션 등을 물어보세요.</p>
                            <div class="quick-questions">
                                <button class="quick-question" onclick="askQuestion('어떤 카드가 저에게 가장 좋을까요?')">어떤 카드가 저에게 가장 좋을까요?</button>
                                <button class="quick-question" onclick="askQuestion('Housing-only와 Flexible 차이점은?')">Housing-only와 Flexible 차이점은?</button>
                                <button class="quick-question" onclick="askQuestion('현재 값 기준 어떤 옵션이 유리할까요?')">현재 값 기준 어떤 옵션이 유리?</button>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="질문 입력..." onkeypress="handleKeyPress(event)">
                        <button onclick="sendMessage()" id="sendBtn">전송</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Bilt system prompt for Gemini
        const SYSTEM_PROMPT = `당신은 Bilt 카드 선택과 리워드 최적화를 도와주는 전문 어시스턴트입니다.

## Bilt 카드 2.0 옵션 (2026년 1월 기준)

### 카드 종류
1. **Bilt Blue** ($0 연회비)
   - 웰컴 보너스: $100 Bilt Cash
   - 일상 지출: 1X 포인트
   - 주거비: 0X~1.25X (Housing-only) 또는 최대 1X (Flexible)

2. **Bilt Obsidian** ($95 연회비)
   - 웰컴 보너스: $200 Bilt Cash
   - 여행: 2X, 다이닝/그로서리(택1): 3X, 기타: 1X
   - 주거비: 0X~1.25X (Housing-only) 또는 최대 1X (Flexible)
   - $100 연간 호텔 크레딧 (반기별 $50)

3. **Bilt Palladium** ($495 연회비)
   - 웰컴 보너스: $300 Bilt Cash + 50,000 포인트 (3개월 $4,000 지출 시) + Gold Elite
   - 모든 일상 지출: 2X 포인트
   - 주거비: 0X~1.25X (Housing-only) 또는 최대 1X (Flexible)
   - $200 연간 Bilt Cash + $400 연간 호텔 크레딧 (반기별 $200)

### 리워드 옵션
1. **Housing-only Option**
   - 주거비에 자동 포인트 적립 (Everyday Spend Ratio에 따라 0X~1.25X)
   - 25% 미만: 0X (최소 250 포인트 보장)
   - 25%~50%: 0.5X
   - 50%~75%: 0.75X
   - 75%~100%: 1X
   - 100% 이상: 1.25X
   - 일상 지출에서 Bilt Cash 적립 없음

2. **Flexible Bilt Cash Option**
   - 일상 지출 4% Bilt Cash 적립
   - $3 Bilt Cash = 100 포인트 비율로 주거비 포인트 잠금 해제 (최대 1X)
   - 기본 옵션

### 포인트 가치
- Bilt 포인트는 항공 마일리지 전환 시 약 1.5~2센트 가치
- 보수적 계산: 1포인트 = 1.5센트

사용자의 질문에 친절하고 정확하게 답변하세요. 계산기 값이 제공되면 그 값을 기반으로 맞춤 조언을 제공하세요. 답변은 간결하게 해주세요.`;

        // Global state
        let conversationHistory = [];

        // 2D Input Configuration
        const INPUT_2D_CONFIG = {
            maxHousing: 5000,
            maxSpend: 5000,
            minValue: 0
        };

        // 2D Input Setup
        function setup2DInput() {
            const area = document.getElementById('input2dArea');
            const point = document.getElementById('input2dPoint');
            const crosshairH = document.getElementById('crosshairH');
            const crosshairV = document.getElementById('crosshairV');

            let isDragging = false;

            function updatePosition(clientX, clientY) {
                const rect = area.getBoundingClientRect();
                let x = (clientX - rect.left) / rect.width;
                let y = (clientY - rect.top) / rect.height;

                // Clamp values
                x = Math.max(0, Math.min(1, x));
                y = Math.max(0, Math.min(1, y));

                // Update point position
                point.style.left = (x * 100) + '%';
                point.style.top = (y * 100) + '%';

                // Update crosshairs
                crosshairH.style.top = (y * 100) + '%';
                crosshairV.style.left = (x * 100) + '%';

                // Calculate values (Y is inverted: top = max, bottom = min)
                const spend = Math.round(x * INPUT_2D_CONFIG.maxSpend / 50) * 50;
                const housing = Math.round((1 - y) * INPUT_2D_CONFIG.maxHousing / 50) * 50;

                // Update inputs
                document.getElementById('everydaySpend').value = spend;
                document.getElementById('housingCost').value = housing;

                // Recalculate
                calculate();
            }

            function startDrag(e) {
                isDragging = true;
                e.preventDefault();
                const touch = e.touches ? e.touches[0] : e;
                updatePosition(touch.clientX, touch.clientY);
            }

            function moveDrag(e) {
                if (!isDragging) return;
                e.preventDefault();
                const touch = e.touches ? e.touches[0] : e;
                updatePosition(touch.clientX, touch.clientY);
            }

            function endDrag() {
                isDragging = false;
            }

            // Mouse events
            area.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', moveDrag);
            document.addEventListener('mouseup', endDrag);

            // Touch events
            area.addEventListener('touchstart', startDrag, { passive: false });
            document.addEventListener('touchmove', moveDrag, { passive: false });
            document.addEventListener('touchend', endDrag);

            // Initialize position based on default values
            initializePointPosition();
        }

        function initializePointPosition() {
            updatePointFromInputs();
        }

        function updatePointFromInputs() {
            const housing = parseFloat(document.getElementById('housingCost').value) || 0;
            const spend = parseFloat(document.getElementById('everydaySpend').value) || 0;

            // Clamp to max values for display
            const clampedHousing = Math.min(housing, INPUT_2D_CONFIG.maxHousing);
            const clampedSpend = Math.min(spend, INPUT_2D_CONFIG.maxSpend);

            const x = clampedSpend / INPUT_2D_CONFIG.maxSpend;
            const y = 1 - (clampedHousing / INPUT_2D_CONFIG.maxHousing);

            const point = document.getElementById('input2dPoint');
            const crosshairH = document.getElementById('crosshairH');
            const crosshairV = document.getElementById('crosshairV');

            point.style.left = (x * 100) + '%';
            point.style.top = (y * 100) + '%';
            crosshairH.style.top = (y * 100) + '%';
            crosshairV.style.left = (x * 100) + '%';
        }

        function onManualInput() {
            updatePointFromInputs();
            calculate();
        }

        // Toggle chat
        function toggleChat() {
            document.getElementById('chatSection').classList.toggle('collapsed');
        }

        // Calculate rewards
        function calculate() {
            const housingCost = parseFloat(document.getElementById('housingCost').value) || 0;
            const everydaySpend = parseFloat(document.getElementById('everydaySpend').value) || 0;
            const card = document.querySelector('input[name="card"]:checked').value;
            const option = document.querySelector('input[name="option"]:checked').value;

            const ratio = housingCost > 0 ? (everydaySpend / housingCost) : 0;
            const ratioPercent = (ratio * 100).toFixed(1);

            // Housing-only multiplier
            let housingMultiplier;
            if (ratio < 0.25) housingMultiplier = 0;
            else if (ratio < 0.50) housingMultiplier = 0.5;
            else if (ratio < 0.75) housingMultiplier = 0.75;
            else if (ratio < 1.00) housingMultiplier = 1.0;
            else housingMultiplier = 1.25;

            // Card multiplier for everyday spend
            let everydayMultiplier;
            switch (card) {
                case 'blue': everydayMultiplier = 1; break;
                case 'obsidian': everydayMultiplier = 1.5; break;
                case 'palladium': everydayMultiplier = 2; break;
            }

            let monthlyHousingPoints, monthlyEverydayPoints, monthlyBiltCash, remainingBiltCash;

            if (option === 'housing') {
                monthlyHousingPoints = housingCost * housingMultiplier;
                if (housingMultiplier === 0 && housingCost > 0) {
                    monthlyHousingPoints = 250;
                }
                monthlyEverydayPoints = everydaySpend * everydayMultiplier;
                monthlyBiltCash = 0;
                remainingBiltCash = 0;
            } else {
                monthlyBiltCash = everydaySpend * 0.04;
                const unlockablePoints = (monthlyBiltCash / 3) * 100;
                monthlyHousingPoints = Math.min(unlockablePoints, housingCost);
                const usedBiltCash = (monthlyHousingPoints / 100) * 3;
                remainingBiltCash = monthlyBiltCash - usedBiltCash;
                monthlyEverydayPoints = everydaySpend * everydayMultiplier;
            }

            const annualPoints = (monthlyHousingPoints + monthlyEverydayPoints) * 12;
            const pointValue = 0.015;

            let annualBenefits = 0;
            let annualFee = 0;
            switch (card) {
                case 'blue': annualFee = 0; break;
                case 'obsidian': annualFee = 95; annualBenefits = 100; break;
                case 'palladium': annualFee = 495; annualBenefits = 200 + 400; break;
            }

            const annualBiltCash = (monthlyBiltCash * 12) + remainingBiltCash * 12;
            const annualValue = (annualPoints * pointValue) + annualBiltCash + annualBenefits - annualFee;

            document.getElementById('monthlyHousingPoints').textContent = Math.round(monthlyHousingPoints).toLocaleString();
            document.getElementById('monthlyEverydayPoints').textContent = Math.round(monthlyEverydayPoints).toLocaleString();
            document.getElementById('monthlyBiltCash').textContent = '$' + monthlyBiltCash.toFixed(2);
            document.getElementById('remainingBiltCash').textContent = '$' + remainingBiltCash.toFixed(2);
            document.getElementById('annualValue').textContent = '$' + annualValue.toFixed(0);
            document.getElementById('spendRatio').textContent = ratioPercent + '%';
            document.getElementById('housingMultiplier').textContent = housingMultiplier + 'X';
            document.getElementById('annualPoints').textContent = Math.round(annualPoints).toLocaleString();

            updateComparison(housingCost, everydaySpend, option, housingMultiplier);
        }

        function updateComparison(housingCost, everydaySpend, option, housingMultiplier) {
            const cards = ['blue', 'obsidian', 'palladium'];
            const results = [];

            cards.forEach(card => {
                let everydayMultiplier;
                switch (card) {
                    case 'blue': everydayMultiplier = 1; break;
                    case 'obsidian': everydayMultiplier = 1.5; break;
                    case 'palladium': everydayMultiplier = 2; break;
                }

                let monthlyHousingPoints, monthlyBiltCash, remainingBiltCash;

                if (option === 'housing') {
                    monthlyHousingPoints = housingCost * housingMultiplier;
                    if (housingMultiplier === 0 && housingCost > 0) monthlyHousingPoints = 250;
                    monthlyBiltCash = 0;
                    remainingBiltCash = 0;
                } else {
                    monthlyBiltCash = everydaySpend * 0.04;
                    const unlockablePoints = (monthlyBiltCash / 3) * 100;
                    monthlyHousingPoints = Math.min(unlockablePoints, housingCost);
                    const usedBiltCash = (monthlyHousingPoints / 100) * 3;
                    remainingBiltCash = monthlyBiltCash - usedBiltCash;
                }

                const monthlyEverydayPoints = everydaySpend * everydayMultiplier;
                const annualPoints = (monthlyHousingPoints + monthlyEverydayPoints) * 12;

                let annualFee = 0, annualBenefits = 0;
                switch (card) {
                    case 'blue': annualFee = 0; break;
                    case 'obsidian': annualFee = 95; annualBenefits = 100; break;
                    case 'palladium': annualFee = 495; annualBenefits = 600; break;
                }

                const annualBiltCash = remainingBiltCash * 12;
                const annualValue = (annualPoints * 0.015) + annualBiltCash + annualBenefits - annualFee;

                results.push({ card, value: annualValue, points: annualPoints });
            });

            const maxValue = Math.max(...results.map(r => r.value));

            const grid = document.getElementById('comparisonGrid');
            grid.innerHTML = results.map(r => `
                <div class="comparison-card ${r.value === maxValue ? 'best' : ''}">
                    <div class="card-name">${r.card.charAt(0).toUpperCase() + r.card.slice(1)}</div>
                    <div class="card-value">$${r.value.toFixed(0)}</div>
                    <div class="card-detail">${Math.round(r.points).toLocaleString()} pts/yr</div>
                    ${r.value === maxValue ? '<span class="best-badge">BEST</span>' : ''}
                </div>
            `).join('');
        }

        // Chat functions
        function getCalculatorContext() {
            const housingCost = document.getElementById('housingCost').value;
            const everydaySpend = document.getElementById('everydaySpend').value;
            const card = document.querySelector('input[name="card"]:checked').value;
            const option = document.querySelector('input[name="option"]:checked').value;
            const ratio = ((parseFloat(everydaySpend) / parseFloat(housingCost)) * 100).toFixed(1);

            return `[계산기 값] 주거비: $${housingCost}, 일상지출: $${everydaySpend}, 비율: ${ratio}%, 카드: ${card}, 옵션: ${option}`;
        }

        async function sendMessage() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!apiKey) {
                addMessage('API Key를 입력해주세요.', 'system');
                return;
            }

            if (!message) return;

            const welcome = document.querySelector('.welcome-message');
            if (welcome) welcome.remove();

            addMessage(message, 'user');
            input.value = '';
            document.getElementById('sendBtn').disabled = true;

            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = '<span></span><span></span><span></span>';
            document.getElementById('chatMessages').appendChild(typingDiv);
            scrollToBottom();

            try {
                const contextMessage = getCalculatorContext();
                const fullMessage = contextMessage + '\n\n질문: ' + message;

                conversationHistory.push({
                    role: 'user',
                    parts: [{ text: fullMessage }]
                });

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [
                            { role: 'user', parts: [{ text: SYSTEM_PROMPT }] },
                            { role: 'model', parts: [{ text: '네, Bilt 카드 전문 어시스턴트로서 도와드리겠습니다.' }] },
                            ...conversationHistory
                        ],
                        generationConfig: { temperature: 0.7, maxOutputTokens: 2000 }
                    })
                });

                typingDiv.remove();

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'API 요청 실패');
                }

                const data = await response.json();
                const assistantMessage = data.candidates?.[0]?.content?.parts?.[0]?.text || '응답을 받지 못했습니다.';

                conversationHistory.push({
                    role: 'model',
                    parts: [{ text: assistantMessage }]
                });

                addMessage(assistantMessage, 'assistant');

            } catch (error) {
                typingDiv.remove();
                addMessage('오류: ' + error.message, 'system');
            }

            document.getElementById('sendBtn').disabled = false;
        }

        function parseMarkdown(text) {
            // Escape HTML first
            let html = text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

            // Bold: **text** or __text__
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');

            // Italic: *text* or _text_
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
            html = html.replace(/_(.+?)_/g, '<em>$1</em>');

            // Inline code: `code`
            html = html.replace(/`(.+?)`/g, '<code>$1</code>');

            // Convert line breaks to handle lists and paragraphs
            const lines = html.split('\n');
            let result = [];
            let inList = false;
            let listType = null;

            for (let line of lines) {
                const trimmed = line.trim();

                // Unordered list
                if (trimmed.match(/^[-*]\s+/)) {
                    if (!inList || listType !== 'ul') {
                        if (inList) result.push(`</${listType}>`);
                        result.push('<ul>');
                        inList = true;
                        listType = 'ul';
                    }
                    result.push('<li>' + trimmed.replace(/^[-*]\s+/, '') + '</li>');
                }
                // Numbered list
                else if (trimmed.match(/^\d+\.\s+/)) {
                    if (!inList || listType !== 'ol') {
                        if (inList) result.push(`</${listType}>`);
                        result.push('<ol>');
                        inList = true;
                        listType = 'ol';
                    }
                    result.push('<li>' + trimmed.replace(/^\d+\.\s+/, '') + '</li>');
                }
                // Regular text
                else {
                    if (inList) {
                        result.push(`</${listType}>`);
                        inList = false;
                        listType = null;
                    }
                    if (trimmed === '') {
                        result.push('<br>');
                    } else {
                        result.push('<p>' + line + '</p>');
                    }
                }
            }

            if (inList) {
                result.push(`</${listType}>`);
            }

            return result.join('');
        }

        function addMessage(text, type) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type;

            if (type === 'assistant') {
                messageDiv.innerHTML = parseMarkdown(text);
            } else {
                messageDiv.textContent = text;
            }

            messagesDiv.appendChild(messageDiv);
            scrollToBottom();
        }

        function scrollToBottom() {
            const messagesDiv = document.getElementById('chatMessages');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') sendMessage();
        }

        function askQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        // Initialize
        setup2DInput();
        calculate();
    </script>
</body>
</html>
